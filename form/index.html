<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">
  <meta name="description" content="">
  <meta name="author" content="Ethan Merchant">
  <title>form</title>
  <link rel="stylesheet" href="/style.css?v6">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit" async defer></script>
  <script src="/include/includer.js?v6"></script>
</head>

<body>
  <div id="nav"></div>
  <br>
  <h1>thee</h1>
  <ol>
    <li>select client name (new or pre-existing)</li>
    <li>mark desired time(s) on calender</li>
    <li>fill out the rest as needed and submit</li>
  </ol>
  <form id="short-form" action="https://api.staticforms.xyz/submit" method="post">
    calender (EST pm)</br>
    <div id="calender"></div><br>
    client: <select name="$client" id="client" onchange="clientSelect(this)"></select><br><br>
    <div id="new-client">
      name<br>
      <input type="text" name="name" placeholder="client name"><br>
      phone<br>
      <input type="text" name="phone" placeholder="(206)782-8410"><br>
      email<br>
      <input type="text" name="email" placeholder="name@example.com"><br>
    </div>
    <div id="current-client"></div>
    <!-- + sessions: <select name="$sessions" id="sessions"></select><br>
    <span style="font-style: italic;">*payments are invoiced</span><br><br><br> -->
    notes<br>
    <textarea name="message" rows="4"></textarea><br>
    <!-- <a href="/policy" target="_blank">attendance policy</a><br><br> -->

    <input type="hidden" name="accessKey" value="825356ca-d586-418b-9e7c-899044998d39">
    <input type="hidden" name="replyTo" value="@">
    <input type="text" name="honeypot" style="display: none;">
    <input type="hidden" name="redirectTo" value="https://ethanmerchant.com/ty">

    <div id="captcha"></div>
    <div id="submit-button"></div>
  </form>
  <div onclick="notifyMe()" class="btn">notify</div>
  <br><br>
  <div id="footer"></div>
</body>

<script>
  function notifyMe() {
    console.log("notify");
    let promise = Notification.requestPermission();
    // // Let's check if the browser supports notifications
    // if (!("Notification" in window)) {
    //   alert("This browser does not support desktop notification")
    // } // Let's check whether notification permissions have already been granted
    // else if (Notification.permission === "granted") {
    //   // If it's okay let's create a notification
    //   var notification = new Notification("Hi there!")
    // } // Otherwise, we need to ask the user for permission
    // else if (Notification.permission !== "denied") {
    //   Notification.requestPermission().then(function (permission) {
    //     // If the user accepts, let's create a notification
    //     if (permission === "granted") {
    //       var notification = new Notification("Hi there!")
    //     }
    //   })
    // }
  }

  // captcha
  var verifyCallback = function (response) {
    // console.log(response);
    if (response) {
      setTimeout(myCallback, 1000)
    }
  }

  function myCallback() {
    $('#submit-button').html(`<input type="submit" value="submit">`)
    $('#captcha').hide()
  }

  var onloadCallback = function () {
    grecaptcha.render('captcha', {
      'sitekey': '6Lcew6wfAAAAANv6YG7NVDJHAPpyC-XNbbtYmp2w',
      'callback': verifyCallback,
      'theme': 'dark'
    })
  }

  const dotw = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday']

  const clients = [
    {
      name: 'jared',
      sessions: 0, streak: 0,
      times: [{ day: 5, hour: 5 }, { day: 5, hour: 6 }]
    },
    {
      name: 'niko',
      sessions: 0, streak: 0,
      times: [{ day: 4, hour: 5 }, { day: 4, hour: 6 }]
    },
    {
      name: 'nova',
      sessions: 0, streak: 0,
      times: [{ day: 1, hour: 5 }, { day: 1, hour: 6 }]
    },
    {
      name: 'dallin',
      sessions: 0, streak: 0,
      times: [{ day: 0, hour: 6 }]
    },
    {
      name: 'mariah',
      sessions: 0, streak: 0,
      times: [{ day: 5, hour: 4 }]
    },
    {
      name: 'miranda',
      sessions: 0, streak: 0,
      times: [{ day: 4, hour: 4 }]
    },
    {
      name: 'jacob',
      sessions: 0, streak: 0,
      times: [{ day: 6, hour: 4 }]
    },
    {
      name: 'zen',
      sessions: 0, streak: 0,
      times: [{ day: 2, hour: 4 }]
    },
    {
      name: 'bryan',
      sessions: 0, streak: 0,
      times: [{ day: 6, hour: 5 }, { day: 6, hour: 6 }]
    },
    {
      name: 'michael',
      sessions: 0, streak: 0,
      times: [{ day: 0, hour: 4 }]
    },
    {
      name: 'nathan',
      sessions: 0, streak: 0,
      times: [{ day: 1, hour: 4 }, { day: 3, hour: 5 }]
    },
    {
      name: 'sanjit',
      sessions: 0, streak: 0,
      times: [{ day: 0, hour: 5 }]
    }
  ]

  $(document).ready(function () {
    let html = ""
    html += `<option value="new">new</option>`
    for (let i = 0; i < clients.length; i++) {
      html += `<option value="${clients[i].name}">${clients[i].name}</option>`
    }
    $("#client").html(html)

    clientSelect(document.getElementById("client"))
  })

  var client
  function clientSelect(el) {
    client = el.value;
    let html = ""
    let sessions = `
      <option value="01">01 * $20/hr = $20</option>
      <option value="04">04 * $19/hr = $76</option>
      <option value="08">08 * $18/hr = $144</option>
      <option value="16">16 * $17/hr = $272</option>
      <option value="32">32 * $16/hr = $512</option>
    `
    if (client == "new") {
      $("#new-client").show()

    } else {
      $("#new-client").hide()
      for (s of clients) {
        if (s.name == client) {
          // html += `sessions remaining: ${s.sessions}<br>`
          html += `attendance streak: ${s.streak}<br><br>`
        }
      }
      sessions = `<option value="00">use remaining</option>` + sessions
    }
    $("#current-client").html(html)
    $("#sessions").html(sessions)
    calender()
  }

  function calender() {
    const d = new Date()
    let day = d.getDay()
    let html = ""
    for (let i = 0; i < dotw.length; i++) {
      html += `<div class="day">`
      let style = i == day ? 'color: var(--white);' : ''
      html += `<div class="date" style="${style}">&nbsp;${dotw[i]}</div>`
      html += `<div class="hours">`
      html += `<label class="check">4<input type="checkbox" ${status(i, 4)} name="$${dotw[i] + 4}"><span class="checkmark"></span></label>`
      html += `<label class="check">5<input type="checkbox" ${status(i, 5)} name="$${dotw[i] + 5}"><span class="checkmark"></span></label>`
      html += `<label class="check">6<input type="checkbox" ${status(i, 6)} name="$${dotw[i] + 6}"><span class="checkmark"></span></label>`
      html += `</div>`
      html += `</div>`
    }

    $('#calender').html(html)
  }

  function status(day, hour) {
    for (let i = 0; i < clients.length; i++) {
      for (let j = 0; j < clients[i].times.length; j++) {
        if (clients[i].times[j].day == day && clients[i].times[j].hour == hour) {
          if (clients[i].name == client) {
            return "checked"
          } else {
            return "disabled"
          }
        }
      }
    }
    return "";
  }
</script>

</html>